{
  "title": "vLLM â€” Workload Overview",
  "tags": ["llm", "vllm", "meluxina"],
  "schemaVersion": 39,
  "version": 1,
  "refresh": "5s",
  "time": { "from": "now-15m", "to": "now" },
  "panels": [
    {"id": 1, "type": "timeseries", "title": "Targets UP (vLLM)",
      "gridPos": {"h": 5, "w": 8, "x": 0, "y": 0},
      "targets": [{"refId": "A", "expr": "up{job=\"vllm-clients\"}", "legendFormat": "{{instance}}"}]},
    {"id": 2, "type": "stat", "title": "Requests (cumulative) by host",
      "gridPos": {"h": 5, "w": 8, "x": 8, "y": 0},
      "targets": [{"refId": "A", "expr": "sum by (host) (vllm_requests_total)"}],
      "options": {"reduceOptions": {"calcs": ["lastNotNull"]}}},
    {"id": 8, "type": "stat", "title": "Workload running",
      "gridPos": {"h": 5, "w": 8, "x": 16, "y": 0},
      "targets": [{"refId": "A", "expr": "max(vllm_workload_running)"}],
      "options": {"reduceOptions": {"calcs": ["lastNotNull"]}}},

    {"id": 3, "type": "timeseries", "title": "Requests per second (rate 1m)",
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 5},
      "targets": [{"refId": "A", "expr": "sum by (host) (rate(vllm_requests_total[1m]))", "legendFormat": "{{host}}"}]},
    {"id": 4, "type": "timeseries", "title": "Throughput (vllm_throughput_rps)",
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 5},
      "targets": [{"refId": "A", "expr": "sum by (host) (vllm_throughput_rps)", "legendFormat": "{{host}}"}]},

    {"id": 5, "type": "stat", "title": "Latency avg (s)",
      "gridPos": {"h": 5, "w": 8, "x": 0, "y": 13},
      "targets": [{"refId": "A", "expr": "avg(vllm_request_latency_seconds)"}],
      "fieldConfig": {"defaults": {"unit": "s"}},
      "options": {"reduceOptions": {"calcs": ["lastNotNull"]}}},
    {"id": 9, "type": "timeseries", "title": "Latency p95 (1m window)",
      "gridPos": {"h": 5, "w": 8, "x": 8, "y": 13},
      "targets": [{"refId": "A", "expr": "quantile_over_time(0.95, vllm_request_latency_seconds[1m])", "legendFormat": "p95"}],
      "fieldConfig": {"defaults": {"unit": "s"}}},
    {"id": 6, "type": "stat", "title": "Errors (cumulative)",
      "gridPos": {"h": 5, "w": 8, "x": 16, "y": 13},
      "targets": [{"refId": "A", "expr": "sum(vllm_errors_total)"}],
      "options": {"reduceOptions": {"calcs": ["lastNotNull"]}}},

    {"id": 10, "type": "timeseries", "title": "Requests success vs failed (cumulative)",
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 18},
      "targets": [
        {"refId": "A", "expr": "sum(vllm_requests_success)", "legendFormat": "success"},
        {"refId": "B", "expr": "sum(vllm_requests_failed)", "legendFormat": "failed"}
      ],
      "options": {"legend": {"showLegend": true}}},
    {"id": 11, "type": "timeseries", "title": "Errors per second (rate 1m)",
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 18},
      "targets": [{"refId": "A", "expr": "sum by (host) (rate(vllm_errors_total[1m]))", "legendFormat": "{{host}}"}]},

    {"id": 12, "type": "stat", "title": "Tokens per request",
      "gridPos": {"h": 5, "w": 6, "x": 0, "y": 26},
      "targets": [{"refId": "A", "expr": "avg(vllm_tokens_per_request)"}],
      "options": {"reduceOptions": {"calcs": ["lastNotNull"]}}},
    {"id": 13, "type": "stat", "title": "Cache usage (%)",
      "gridPos": {"h": 5, "w": 6, "x": 6, "y": 26},
      "targets": [{"refId": "A", "expr": "avg(vllm_cache_usage_percentage)"}],
      "fieldConfig": {"defaults": {"unit": "percent"}},
      "options": {"reduceOptions": {"calcs": ["lastNotNull"]}}},

    {"id": 7, "type": "table", "title": "Requests (cumulative) by host",
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 26},
      "targets": [{"refId": "A", "expr": "sum by (host) (vllm_requests_total)"}],
      "transformations": [{"id": "organize", "options": {"excludeByName": {"__name__": true}, "renameByName": {"host": "Host"}}}]}
  ]
}
